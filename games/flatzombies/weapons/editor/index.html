<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Редактор оружия</title>
	<link rel="stylesheet" href="styles.css">
</head>

<body>
	<div class="container">
		<!-- Левая панель: Доступные параметры -->
		<div class="panel" id="leftPanel" style="display: none;">
			<span style="position: relative;">
				<div class="titlePanel">Доступные параметры</div>
				<div onclick="showAddNewField()" data-tooltip="Добавить новый параметр" class="addNewField" id="addNewField">
					<img src="images/add.png" width="100%" height="100%">
				</div>

				<div onclick="closeAddNewField()" data-tooltip="Закрыть" style="display: none;" class="addNewField" id="closeNewField">
					<img src="images/close.png" width="100%" height="100%">
				</div>


			</span>

			<div id="newFieldPanel" style="display: none;">
				<div class="fields">
					<span data-tooltip="Путь к свойству объекта">Свойство объекта:</span>
					<span data-tooltip="Значение свойства">Значение:</span>
					<input type="text" id="newFieldPath" class="panelInput" value="" placeholder="object.MonoBehaviour.field">
					<input type="text" id="newFieldValue" class="panelInput" value="" placeholder="(0.5, 0.12, 0)">
					<span></span>
					<span><br><button onclick="createParam()" class="add">Добавить</button></span>
				</div>

				<br>
			</div>

			<span style="position: relative;">
				<input type="text" id="searchInput" class="panelInput" placeholder="Поиск параметров...">
				<button class="clearInput" id="clearInput" style="display: none;">
					<img src="images/close.png" width="100%" height="100%">
				</button>
			</span>
			<ul id="availableParamsList"></ul>
		</div>

		<!-- Центральная панель: Добавленные/Отредактированные параметры -->
		<div class="panel" id="centerPanel">
			<div class="titlePanel">Отредактированные параметры</div>
			<img src="images/loading.png" width="48px" height="48px" style="margin: auto; margin-top: 40px;" id="loading">
			<div class="fields hidden" id="startFields">
				<label for="idWeapon">ID:</label>
				<label for="idTemplate">Шаблон:</label>
				<input type="text" id="idWeapon" class="panelInput" placeholder="[a-z]">
				<select id="idTemplate" class="panelInput">
					<option value="">Выберите оружие</option>
				</select>
			</div>
			<ul id="editedParamsList"></ul>
			<div class="buttonPanel hidden" id="buttonPanel">
				<button id="importJsonFile" class="resultButton jsonFileButton" data-tooltip="Открыть файл с модом">Импорт...</button>
				<button id="exportJsonFile" class="resultButton jsonFileButton" data-tooltip="Сохранить мод в файлы">Экспорт...</button>
				<div class="savePanel">
					<div id="saveState" style="display: none; width: 100%; text-align: center;">Сохранение...<br>
						<img src="images/loading.png" width="48px" height="48px" style="margin: auto; margin-top: 12px;">
					</div>
					<form method="GET" class="save" id="save">
						<button type="submit" id="saveButton" class="resultButton">Сохранить</button>
						<input type="hidden" name="action" value="login">
						<input data-tooltip="Логин и пароль для вашего мода.<br>Пароль нужен, чтобы только вы могли редактировать свои моды, чтобы никакой PROгебатор-228из5Б не мог изменить и сломать ваше творение" type="text" name="login" id="login" placeholder="Логин" required="" autocomplete="username">
						<input data-tooltip="Браузер должен будет предложить сохранить пароль.<br>Сохраните пароль и используйте его при повторном запуске страницы" type="password" name="password" id="password" placeholder="Пароль" required="" autocomplete="current-password">
					</form>
				</div>
			</div>

		</div>

		<!-- Правая панель: Предпросмотр -->
		<div class="panel" id="rightPanel" style="display: none;">
			<span style="position: relative;">
				<div class="titlePanel">Предпросмотр</div>
				<img src="images/mouse.png" style="position: absolute; top: -2px; right: 2px; z-index: 10; height: 26px; cursor: help;" data-tooltip="Используйте кнопки мыши<br><b>ЛКМ</b> - выбрать спрайт и переместить, при нажатии в пустую область двигать всю область предпросмотра<br><b>Колесо мыши</b> - увеличить/уменьшить предпросмотр<br><b>Нажатие на колесо</b> - двигать область предпросмотра" onclick="alert('Используйте кнопки мыши\nЛКМ - выбрать спрайт и переместить\nКолесо мыши - увеличить/уменьшить предпросмотр\nНажатие на колесо - двигать все спрайты для предпросмотра')">
			</span>
			<!-- Рендер объектов -->
			<canvas id="scene" width="600" height="440"></canvas>

			<!-- Добавляем отображение иерархии и свойств (для отладки и редактирования) -->
			<div class="hierarchy">
				<div class="objectList">
					<span>Объекты:</span>
					<div id="hierarchy"></div>
				</div>
				<div>
					<span id="propName" style="text-align: right; overflow: hidden; text-wrap-mode: nowrap;"></span>
					<hr>
					<div id="properties" style="display: none;">
						<div>
							<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center;" data-tooltip="Позиция объекта внутри родительского объекта">
								<span style="text-align: center;">X:</span><input type="text" id="propPosX" step="0.01">
								<span style="text-align: center;">Y:</span><input type="text" id="propPosY" step="0.01">
							</div>
						</div>
						<div>
							<label for="propAngle" data-tooltip="Угол поворота в градусах">Local Angle:</label>
							<div style="display: grid; grid-template-columns: 65% 30%; align-items: center; justify-content: space-between;">
								<input type="range" min="-180" max="180" step="1" id="propAngleSlider">
								<input type="text" min="-180" max="180" step="0.01" placeholder="float" id="propAngle" data-tooltip="Угол поворота в градусах">
							</div>
						</div>
						<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center; justify-content: space-between;">
							<label for="propSortingOrder" style="text-align: center;" data-tooltip="Порядок отрисовки<br>SpriteRenderer.sortingOrder">Sort:</label>
							<input type="text" id="propSortingOrder" step="1">
							<label for="propPixelsPerUnit" style="text-align: center;" data-tooltip="Пикселей на единицу расстояния<br>Pixels Per Unit">PPU:</label>
							<input type="text" id="propPixelsPerUnit" step="5">
						</div>
						<div>
							<span data-tooltip="Точка вращения объекта">Pivot point:</span>
							<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center;">
								<span style="text-align: center;">X:</span><input type="text" id="propPivotX" step="0.01">
								<span style="text-align: center;">Y:</span><input type="text" id="propPivotY" step="0.01">
							</div>

						</div>

						<div>
							<label for="propTexture">Текстура:</label>
							<input type="text" id="propTexture">
							<label class="fileInputLabel">
								<input type="file" class="fileInput" accept=".png" id="sceneFileInput">
								<span class="fileInputButton" data-tooltip="Загрузить PNG-файл">Заменить</span>
							</label>
						</div>

						<div style="display: flex;align-items: center;margin-top: 10px;">
							<input type="checkbox" id="propRenderEnabled" data-tooltip="Показать/скрыть рендер при загрузке в игру<br>object.SpriteRenderer.enabled = false/true;">
							<input type="checkbox" id="propGameObjActive" data-tooltip="Показать/скрыть объект вместе с дочерними спрайтами<br>object.gameObject.SetActive(false/true);">
							Показать
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Всплывающие подсказки
		const tooltip = Object.assign(document.createElement('div'), {
			className: 'smart-tooltip',
			hidden: true
		});
		document.body.appendChild(tooltip);
		const spacing = 8;
		document.addEventListener('mouseover', e => {
			const target = e.target.closest('[data-tooltip]');
			if (!target) return;
			tooltip.innerHTML = target.getAttribute('data-tooltip').replace(/\n/g, '<br>');
			tooltip.hidden = false;
			tooltip.style.opacity = '0';
			const { width: tW, height: tH } = tooltip.getBoundingClientRect();
			const { left, right, top, bottom } = target.getBoundingClientRect();
			let x, y;
			// Приоритет: top → bottom → right → left
			if (top >= tH + spacing) {// Сверху: центрируем
				x = Math.max(spacing, Math.min(left + (right - left) / 2 - tW / 2, window.innerWidth - tW - spacing));
				y = top - tH - spacing;
			} else if (bottom + tH + spacing <= window.innerHeight) {// Снизу: центрируем
				x = Math.max(spacing, Math.min(left + (right - left) / 2 - tW / 2, window.innerWidth - tW - spacing));
				y = bottom + spacing;
			} else if (right + tW + spacing <= window.innerWidth) {// Справа: прижат к правому краю элемента
				x = right + spacing;
				y = Math.max(spacing, Math.min(top + (bottom - top) / 2 - tH / 2, window.innerHeight - tH - spacing));
			} else if (left - tW - spacing >= 0) {// Слева: прижат к левому краю элемента
				x = left - tW - spacing;
				y = Math.max(spacing, Math.min(top + (bottom - top) / 2 - tH / 2, window.innerHeight - tH - spacing));
			} else {// Fallback: сверху слева с отступом
				x = spacing;
				y = Math.max(spacing, top - tH - spacing);
			}
			tooltip.style.left = `${x}px`; tooltip.style.top = `${y}px`;
			tooltip.style.right = tooltip.style.bottom = '';
			tooltip.style.opacity = '1';
		});
		document.addEventListener('mouseout', () => {
			tooltip.style.opacity = 0;
		});

		//Небольшие функции для кнопки Сохранить
		function generateRandomString() {
			const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
			return Array.from({ length: 8 }, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
		}
		const login = document.getElementById('login');
		const password = document.getElementById('password');
		document.getElementById('save').addEventListener('mouseenter', function () { // Проверяем, пусты ли поля при загрузке страницы
			if (!login.value && !password.value) {// Генерируем автоматические значения только если оба поля пусты
				login.value = generateRandomString();
				password.value = generateRandomString();
			}
		});
	</script>



	<!-- Подключаем данные -->
	<script src="config.js"></script> <!-- sampleParams -->
	<!-- Подключаем список оружий -->
	<script src="weapons/aa12.js"></script>
	<script src="weapons/ak12.js"></script>
	<script src="weapons/ak308.js"></script>
	<script src="weapons/ak74u.js"></script>
	<script src="weapons/amb17.js"></script>
	<script src="weapons/ares16.js"></script>
	<script src="weapons/at308.js"></script>
	<script src="weapons/aug.js"></script>
	<script src="weapons/axe.js"></script>
	<script src="weapons/barrettM107A.js"></script>
	<script src="weapons/barrettM99.js"></script>
	<script src="weapons/barrettMRAD.js"></script>
	<script src="weapons/benelli-m4.js"></script>
	<script src="weapons/bow.js"></script>
	<script src="weapons/cougarms.js"></script>
	<script src="weapons/czbren2.js"></script>
	<script src="weapons/czEvo3A1.js"></script>
	<script src="weapons/deagle.js"></script>
	<script src="weapons/dp12.js"></script>
	<script src="weapons/f2000.js"></script>
	<script src="weapons/fd12.js"></script>
	<script src="weapons/forigin12.js"></script>
	<script src="weapons/g36c.js"></script>
	<script src="weapons/galilace21.js"></script>
	<script src="weapons/glock18c.js"></script>
	<script src="weapons/gm94.js"></script>
	<script src="weapons/grizzly85.js"></script>
	<script src="weapons/hk69.js"></script>
	<script src="weapons/imbelai2.js"></script>
	<script src="weapons/katana.js"></script>
	<script src="weapons/ksg.js"></script>
	<script src="weapons/lopata.js"></script>
	<script src="weapons/lr300.js"></script>
	<script src="weapons/m110.js"></script>
	<script src="weapons/m200.js"></script>
	<script src="weapons/mk18.js"></script>
	<script src="weapons/mk46.js"></script>
	<script src="weapons/mk48.js"></script>
	<script src="weapons/mk49.js"></script>
	<script src="weapons/mossberg590.js"></script>
	<script src="weapons/mp5.js"></script>
	<script src="weapons/mr27.js"></script>
	<script src="weapons/p226.js"></script>
	<script src="weapons/p90.js"></script>
	<script src="weapons/pp19bizon.js"></script>
	<script src="weapons/pp90m1.js"></script>
	<script src="weapons/rem870dm.js"></script>
	<script src="weapons/remR11rsass.js"></script>
	<script src="weapons/rpk16.js"></script>
	<script src="weapons/saiga12.js"></script>
	<script src="weapons/sako.js"></script>
	<script src="weapons/scarh.js"></script>
	<script src="weapons/scarlcqc.js"></script>
	<script src="weapons/scarssr.js"></script>
	<script src="weapons/shak12.js"></script>
	<script src="weapons/sigmpx.js"></script>
	<script src="weapons/six12.js"></script>
	<script src="weapons/sr2veresk.js"></script>
	<script src="weapons/sr3m.js"></script>
	<script src="weapons/srm1212.js"></script>
	<script src="weapons/srm1216.js"></script>
	<script src="weapons/sv98.js"></script>
	<script src="weapons/sw686.js"></script>
	<script src="weapons/ump45.js"></script>
	<script src="weapons/vepr12.js"></script>
	<script src="weapons/xtr12.js"></script>
	<!-- Подключаем скрипты -->
	<script src="sceneData.js"></script> <!-- let sceneObjects = [...] -->
	<script src="parameters.js"></script> <!-- editedParams + UI -->
	<script src="preview.js"></script> <!-- renderScene, drag, etc -->
</body>

</html>