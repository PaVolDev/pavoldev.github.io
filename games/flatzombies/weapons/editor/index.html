<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Редактор оружия</title>
	<link rel="stylesheet" href="styles.css">
</head>

<body>
	<div class="container">
		<!-- Левая панель: Доступные параметры -->
		<div class="panel" id="leftPanel" style="display: none;">
			<span style="position: relative;">
				<div class="titlePanel">Доступные параметры</div>
				<div onclick="showAddNewField()" data-tooltip="Добавить новый параметр" class="addNewField" id="addNewField">
					<img src="images/add.png" width="100%" height="100%">
				</div>

				<div onclick="closeAddNewField()" data-tooltip="Закрыть" style="display: none;" class="addNewField" id="closeNewField">
					<img src="images/close.png" width="100%" height="100%">
				</div>


			</span>

			<div id="newFieldPanel" style="display: none;">
				<div class="fields">
					<span data-tooltip="Путь к свойству объекта">Свойство объекта:</span>
					<span data-tooltip="Значение свойства">Значение:</span>
					<input type="text" id="newFieldPath" class="panelInput" value="" placeholder="object.MonoBehaviour.field">
					<input type="text" id="newFieldValue" class="panelInput" value="" placeholder="(0.5, 0.12, 0)">
					<span></span>
					<span><br><button onclick="createParam()" class="add">Добавить</button></span>
				</div>

				<br>
			</div>

			<span style="position: relative;">
				<input type="text" id="searchInput" class="panelInput" placeholder="Поиск параметров...">
				<button class="clearInput" id="clearInput" style="display: none;">
					<img src="images/close.png" width="100%" height="100%">
				</button>
			</span>
			<ul id="availableParamsList"></ul>
		</div>

		<!-- Центральная панель: Добавленные/Отредактированные параметры -->
		<div class="panel" id="centerPanel">
			<div class="titlePanel">Отредактированные параметры</div>
			<img src="images/loading.png" width="48px" height="48px" style="margin: auto; margin-top: 40px; margin-bottom: 40px;" id="loading">
			<div class="fields hidden" id="startFields">
				<label for="idWeapon" >ID:</label>
				<label for="idTemplate">Шаблон:</label>
				<input type="text" id="idWeapon" class="panelInput" placeholder="[a-z-0-9]" data-tooltip="Придумайте и укажите идентификатор своего оружия">
				<select id="idTemplate" class="panelInput">
					<option value="">Выберите оружие</option>
					<option value="aa12">AA-12 (id: aa12)</option>
					<option value="ak12">AK-12 (id: ak12)</option>
					<option value="ak308">AK-308 (id: ak308)</option>
					<option value="ak74u">AK-74U (id: ak74u)</option>
					<option value="amb17">AMB-17 (id: amb17)</option>
					<option value="ares16">ARES-16 (id: ares16)</option>
					<option value="at308">AT-308 (id: at308)</option>
					<option value="aug">AUG (id: aug)</option>
					<option value="axe">Axe - Топор (id: axe)</option>
					<option value="barrettM107A">Barrett M107A (id: barrettM107A)</option>
					<option value="barrettM99">Barrett M99 (id: barrettM99)</option>
					<option value="barrettMRAD">Barrett MRAD (id: barrettMRAD)</option>
					<option value="benelli-m4">Benelli M4 (id: benelli-m4)</option>
					<option value="bow">Bow - Лук (id: bow)</option>
					<option value="cougarms">Cougar MS (id: cougarms)</option>
					<option value="czbren2">CZ Bren 2 (id: czbren2)</option>
					<option value="czEvo3A1">CZ Evo 3 A1 (id: czEvo3A1)</option>
					<option value="deagle">DEagle (id: deagle)</option>
					<option value="dp12">DP-12 (id: dp12)</option>
					<option value="f2000">F2000 (id: f2000)</option>
					<option value="fd12">FD-12 (id: fd12)</option>
					<option value="forigin12">Forigin 12 (id: forigin12)</option>
					<option value="g36c">G36C (id: g36c)</option>
					<option value="galilace21">Galil ACE 21 (id: galilace21)</option>
					<option value="glock18c">Glock 18C (id: glock18c)</option>
					<option value="gm94">GM94 (id: gm94)</option>
					<option value="grizzly85">Grizzly 85 (id: grizzly85)</option>
					<option value="hk69">HK69 (id: hk69)</option>
					<option value="imbelai2">IMBEL AI-2 (id: imbelai2)</option>
					<option value="katana">Katana (id: katana)</option>
					<option value="ksg">KSG (id: ksg)</option>
					<option value="lopata">Shovel - Лопата (id: lopata)</option>
					<option value="lr300">LR-300 (id: lr300)</option>
					<option value="m110">M110 (id: m110)</option>
					<option value="m200">M200 (id: m200)</option>
					<option value="mk18">MK18 (id: mk18)</option>
					<option value="mk46">MK46 (id: mk46)</option>
					<option value="mk48">MK48 (id: mk48)</option>
					<option value="mossberg590">Mossberg 590 (id: mossberg590)</option>
					<option value="mp5">MP5 (id: mp5)</option>
					<option value="mr27">MR27 (id: mr27)</option>
					<option value="p226">P226 (id: p226)</option>
					<option value="p90">P90 (id: p90)</option>
					<option value="pp19bizon">PP-19 Bizon (id: pp19bizon)</option>
					<option value="pp90m1">PP90M1 (id: pp90m1)</option>
					<option value="rem870dm">Remington 870DM (id: rem870dm)</option>
					<option value="remR11rsass">Remington R11 RSASS (id: remR11rsass)</option>
					<option value="rpk16">RPK-16 (id: rpk16)</option>
					<option value="saiga12">Saiga-12 (id: saiga12)</option>
					<option value="sako">Sako (id: sako)</option>
					<option value="scarh">SCAR-H (id: scarh)</option>
					<option value="scarlcqc">SCAR-L CQC (id: scarlcqc)</option>
					<option value="scarssr">SCAR SSR (id: scarssr)</option>
					<option value="shak12">SHAK-12 (id: shak12)</option>
					<option value="sigmpx">SIG MPX (id: sigmpx)</option>
					<option value="six12">SIX-12 (id: six12)</option>
					<option value="sr2veresk">SR-2 Veresk (id: sr2veresk)</option>
					<option value="sr3m">SR-3M (id: sr3m)</option>
					<option value="srm1212">SRM-1212 (id: srm1212)</option>
					<option value="srm1216">SRM-1216 (id: srm1216)</option>
					<option value="sv98">SV-98 (id: sv98)</option>
					<option value="sw686">SW 686 (id: sw686)</option>
					<option value="ump45">UMP45 (id: ump45)</option>
					<option value="vepr12">Vepr-12 (id: vepr12)</option>
					<option value="xtr12">XTR-12 (id: xtr12)</option>
				</select>
			</div>
			<ul id="editedParamsList"></ul>
			<div class="buttonPanel hidden" id="buttonPanel">
				<button id="importJsonFile" class="resultButton jsonFileButton" data-tooltip="Открыть файл с модом">Импорт...</button>
				<button id="exportJsonFile" class="resultButton jsonFileButton" data-tooltip="Сохранить мод в файлы">Экспорт...</button>
				<div class="savePanel">
					<div id="saveState" style="display: none; width: 100%; text-align: center;">Сохранение...<br>
						<img src="images/loading.png" width="48px" height="48px" style="margin: auto; margin-top: 12px;">
					</div>
					<form method="GET" class="save" id="save">
						<button type="submit" id="saveButton" class="resultButton" data-tooltip="Сохранить на общий сервер">Отправить</button>
						<input type="hidden" name="action" value="login">
						<input data-tooltip="Логин и пароль для вашего мода.<br>Пароль нужен, чтобы только вы могли редактировать свои моды, чтобы никакой PROгебатор-228из5Б не мог изменить и сломать ваше творение" type="text" name="login" id="login" placeholder="Логин" required="" autocomplete="username">
						<input data-tooltip="Браузер должен будет предложить сохранить пароль.<br>Сохраните пароль и используйте его при повторном запуске страницы" type="password" name="password" id="password" placeholder="Пароль" required="" autocomplete="current-password">
						<select id="saveMode" data-tooltip="• Закрытый тест - оружие будет доступно только по идентификатору. В режиме Тренировка в списке оружий есть кнопка Добавить, в этом меню укажите идентификатор и загрузите оружие в игру. Можете вносить различные правки в оружие и делать повторную отправку, затем в игре нажать Обновить для перезагрузки мода<br>• Опубликовать - добавить оружие в общий список всем игрокам">
							<option value="test">Закрытый тест</option>
							<option value="publish">Опубликовать</option>
						</select>
					</form>
				</div>
			</div>

		</div>

		<!-- Правая панель: Предпросмотр -->
		<div class="panel" id="rightPanel" style="display: none;">
			<span style="position: relative;">
				<div class="titlePanel">Предпросмотр</div>
				<img src="images/mouse.png" style="position: absolute; top: -2px; right: 2px; z-index: 10; height: 26px; cursor: help;" data-tooltip="Используйте кнопки мыши<br><b>ЛКМ</b> - выбрать спрайт и переместить, при нажатии в пустую область двигать всю область предпросмотра<br><b>Колесо мыши</b> - увеличить/уменьшить предпросмотр<br><b>Нажатие на колесо</b> - двигать область предпросмотра" onclick="alert('Используйте кнопки мыши\nЛКМ - выбрать спрайт и переместить\nКолесо мыши - увеличить/уменьшить предпросмотр\nНажатие на колесо - двигать все спрайты для предпросмотра')">
			</span>
			<!-- Рендер объектов -->
			<canvas id="scene" width="600" height="440"></canvas>

			<!-- Добавляем отображение иерархии и свойств (для отладки и редактирования) -->
			<div class="hierarchy">
				<div class="objectList">
					<span>Объекты:</span>
					<div id="hierarchy"></div>
				</div>
				<div>
					<span id="propName" style="text-align: right; overflow: hidden; text-wrap-mode: nowrap;"></span>
					<hr>
					<div id="properties" style="display: none;">
						<div>
							<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center;" data-tooltip="Позиция объекта внутри родительского объекта">
								<span style="text-align: center;">X:</span><input type="text" id="propPosX" step="0.01">
								<span style="text-align: center;">Y:</span><input type="text" id="propPosY" step="0.01">
							</div>
						</div>
						<div>
							<label for="propAngle" data-tooltip="Угол поворота в градусах">Local Angle:</label>
							<div style="display: grid; grid-template-columns: 65% 30%; align-items: center; justify-content: space-between;">
								<input type="range" min="-180" max="180" step="1" id="propAngleSlider">
								<input type="text" min="-180" max="180" step="0.01" placeholder="float" id="propAngle" data-tooltip="Угол поворота в градусах">
							</div>
						</div>
						<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center; justify-content: space-between;">
							<label for="propSortingOrder" style="text-align: center;" data-tooltip="Порядок отрисовки<br>SpriteRenderer.sortingOrder">Sort:</label>
							<input type="text" id="propSortingOrder" step="1">
							<label for="propPixelsPerUnit" style="text-align: center;" data-tooltip="Пикселей на единицу расстояния<br>Pixels Per Unit">PPU:</label>
							<input type="text" id="propPixelsPerUnit" step="5">
						</div>
						<div>
							<span data-tooltip="Точка вращения объекта">Pivot point:</span>
							<div style="display: grid; grid-template-columns: 20% 30% 20% 30%; align-items: center;">
								<span style="text-align: center;">X:</span><input type="text" id="propPivotX" step="0.01">
								<span style="text-align: center;">Y:</span><input type="text" id="propPivotY" step="0.01">
							</div>

						</div>

						<div>
							<label for="propTexture">Текстура:</label>
							<input type="text" id="propTexture">
							<label class="fileInputLabel">
								<input type="file" class="fileInput" accept=".png" id="sceneFileInput">
								<span class="fileInputButton" data-tooltip="Загрузить PNG-файл">Заменить</span>
							</label>
						</div>

						<div style="display: flex;align-items: center;margin-top: 10px;">
							<input type="checkbox" id="propRenderEnabled" data-tooltip="Показать/скрыть рендер при загрузке в игру<br>object.SpriteRenderer.enabled = false/true;">
							<input type="checkbox" id="propGameObjActive" data-tooltip="Показать/скрыть объект вместе с дочерними спрайтами<br>object.gameObject.SetActive(false/true);">
							Показать
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Всплывающие подсказки
		const tooltip = Object.assign(document.createElement('div'), {
			className: 'smart-tooltip',
			hidden: true
		});
		document.body.appendChild(tooltip);
		const spacing = 8;
		document.addEventListener('mouseover', e => {
			const target = e.target.closest('[data-tooltip]');
			if (!target) return;
			tooltip.innerHTML = target.getAttribute('data-tooltip').replace(/\n/g, '<br>');
			tooltip.hidden = false;
			tooltip.style.opacity = '0';
			const { width: tW, height: tH } = tooltip.getBoundingClientRect();
			const { left, right, top, bottom } = target.getBoundingClientRect();
			let x, y;
			// Приоритет: top → bottom → right → left
			if (top >= tH + spacing) {// Сверху: центрируем
				x = Math.max(spacing, Math.min(left + (right - left) / 2 - tW / 2, window.innerWidth - tW - spacing));
				y = top - tH - spacing;
			} else if (bottom + tH + spacing <= window.innerHeight) {// Снизу: центрируем
				x = Math.max(spacing, Math.min(left + (right - left) / 2 - tW / 2, window.innerWidth - tW - spacing));
				y = bottom + spacing;
			} else if (right + tW + spacing <= window.innerWidth) {// Справа: прижат к правому краю элемента
				x = right + spacing;
				y = Math.max(spacing, Math.min(top + (bottom - top) / 2 - tH / 2, window.innerHeight - tH - spacing));
			} else if (left - tW - spacing >= 0) {// Слева: прижат к левому краю элемента
				x = left - tW - spacing;
				y = Math.max(spacing, Math.min(top + (bottom - top) / 2 - tH / 2, window.innerHeight - tH - spacing));
			} else {// Fallback: сверху слева с отступом
				x = spacing;
				y = Math.max(spacing, top - tH - spacing);
			}
			tooltip.style.left = `${x}px`; tooltip.style.top = `${y}px`;
			tooltip.style.right = tooltip.style.bottom = '';
			tooltip.style.opacity = '1';
		});
		document.addEventListener('mouseout', () => {
			tooltip.style.opacity = 0;
		});

		//Небольшие функции для кнопки Сохранить
		function generateRandomString() {
			const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
			return Array.from({ length: 8 }, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
		}
		const login = document.getElementById('login');
		const password = document.getElementById('password');
		document.getElementById('save').addEventListener('mouseenter', function () { // Проверяем, пусты ли поля при загрузке страницы
			if (!login.value && !password.value) {// Генерируем автоматические значения только если оба поля пусты
				login.value = generateRandomString();
				password.value = generateRandomString();
			}
		});
	</script>



	<!-- Подключаем данные -->
	<script src="config.js"></script> <!-- sampleParams -->
	<!-- Подключаем список оружий -->
	<script src="weapons/aa12.js"></script>
	<script src="weapons/ak12.js"></script>
	<script src="weapons/ak74u.js"></script>
	<!-- Подключаем скрипты -->
	<script src="sceneData.js"></script> <!-- let sceneObjects = [...] -->
	<script src="parameters.js"></script> <!-- editedParams + UI -->
	<script src="preview.js"></script> <!-- renderScene, drag, etc -->
</body>

</html>